#!/bin/bash

# Функция для обработки файлов
process_file() {
  local file="$1"

  # Проверяем, что это обычный файл и его можно прочитать
  if [ -f "$file" ] && [ -r "$file" ]; then
    echo -e "\n===== ФАЙЛ: $file ====="
    cat "$file"
    echo -e "===== КОНЕЦ ФАЙЛА: $file =====\n"
  fi
}

# Функция для рекурсивного обхода каталогов
process_directory() {
  local dir="$1"

  # Перебираем все элементы в текущем каталоге
  for item in "$dir"/*; do
    if [ -f "$item" ]; then
      # Если это файл, обрабатываем его
      process_file "$item"
    elif [ -d "$item" ]; then
      # Если это каталог, рекурсивно обрабатываем его
      process_directory "$item"
    fi
  done
}

# Проверяем, был ли передан аргумент с путем
if [ $# -eq 0 ]; then
  # Если аргументов нет, используем текущий каталог
  start_dir="."
else
  # Иначе используем первый аргумент как начальный каталог
  start_dir="$1"
fi

# Проверяем, существует ли каталог
if [ ! -d "$start_dir" ]; then
  echo "Ошибка: '$start_dir' не является каталогом или не существует."
  exit 1
fi

# Запускаем обработку с указанного каталога
process_directory "$start_dir"
